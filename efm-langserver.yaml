# yaml-language-server: $schema=https://raw.githubusercontent.com/mattn/efm-langserver/master/schema.json

# TODO: lint-after-open should be the default, but it isn't set on the server:
# https://github.com/mattn/efm-langserver/pull/277

# Some of the `lint-format`s came from here:
# https://github.com/llllvvuu/efm-tool-definitions.yaml

version: 2
lint-debounce: 0.5s
root-markers:
  - .git
languages:
  =:
    # TODO: This isn't actually a linter, but `format-command` wasn't working.
    - lint-after-open: true
      lint-on-save: true
      lint-stdin: false
      lint-command: |
        RUN_FIX_ACTIONS='' lefthook run check \
          --jobs format --file "$(realpath --relative-to=${ROOT} ${INPUT})"
      lint-formats:
        - "do not match"
    - lint-source: lefthook-lint
      lint-after-open: true
      lint-on-save: true
      lint-stdin: false
      lint-command: |
        lefthook run check \
          --jobs actionlint \
          --jobs markdownlint-cli2-lint \
          --jobs config-file-validator \
          --jobs typos-lint \
          --jobs editorconfig-checker \
          --jobs nixpkgs-lint \
          --jobs statix-lint \
          --jobs desktop-file-validate \
          --file "$(realpath --relative-to=${ROOT} ${INPUT})"
      lint-formats:
        # config-file-validator, desktop-file-validate
        - "%f: %m"
        # typos-lint, editorconfig-checker, nixpkgs-lint, actionlint
        - "%f:%l:%c: %m"
        # statix-lint
        - "%f>%l:%c:%t:%n:%m"
        # markdownlint-cli2
        - "%f:%l:%c: %m"
        - "%f:%l:%c %m"
        - "%f:%l: %m"
        - "%f:%l %m"
