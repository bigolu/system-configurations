# yaml-language-server: $schema=https://raw.githubusercontent.com/mattn/efm-langserver/master/schema.json

# TODO: lint-after-open should be the default, but it isn't set on the server:
# https://github.com/mattn/efm-langserver/pull/277

version: 2
root-markers:
  - .git
languages:
  =:
    - lint-source: lefthook-lint
      lint-after-open: true
      lint-on-save: true
      lint-stdin: false
      lint-command: |
        lefthook run check \
          --jobs actionlint \
          --jobs markdownlint-cli2-lint \
          --jobs config-file-validator \
          --jobs typos \
          --jobs editorconfig-checker \
          --jobs nixpkgs-lint \
          --jobs statix-lint \
          --file "$(realpath --relative-to=${ROOT} ${INPUT})"
      # Formats must be ordered from most specific to least since efm will try
      # matching them in this order
      lint-formats:
        # statix-lint
        - "%f>%l:%c:%t:%n:%m"
        # typos, editorconfig-checker, nixpkgs-lint, actionlint
        - "%f:%l:%c: %m"
        # markdownlint-cli2
        - "%f:%l:%c %m"
        - "%f:%l %m"
        # config-file-validator
        - "%f: %m"
