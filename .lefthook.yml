# yaml-language-server: $schema=https://json.schemastore.org/lefthook.json

# By default lefthook uses true colors (e.g. #FFFFFF), but they may not be
# readable depending on the terminal background color. Instead I'm using ANSI
# colors since they come from the terminal's color palette.
colors:
  cyan: 6
  gray: 8
  green: 2
  red: 1
  yellow: 3

output: false

pre-commit:
  piped: true
  commands:
    # Code generators
    # SYNC: GENERATORS
    generate-readme-table-of-contents:
      priority: 1
      glob: "README.md"
      run: DIRENV_LOG_FORMAT='' direnv exec "$PWD" bash ./scripts/generate-readme-table-of-contents.bash
    generate-neovim-plugin-list:
      priority: 1
      glob: "*neovim/lua/*.lua"
      run: DIRENV_LOG_FORMAT='' direnv exec "$PWD" bash scripts/generate-neovim-plugin-list.bash
    go-mod-tidy:
      priority: 1
      glob: "*gozip/go.mod"
      run: DIRENV_LOG_FORMAT='' direnv exec "$PWD" bash ./scripts/go-mod-tidy.bash
    gomod2nix:
      priority: 1
      glob: "*gozip/go.mod"
      run: DIRENV_LOG_FORMAT='' direnv exec "$PWD" bash ./scripts/generate-gomod2nix-lock.bash

    # Formatters. Change their priority so we format code after all the code
    # generators have run
    format:
      priority: 2
      run: DIRENV_LOG_FORMAT='' direnv exec "$PWD" bash scripts/treefmt-wrapper.bash {staged_files}
      interactive: true

    # Linters. Change the priority so we lint the code after all code generation
    # and formatting has run, in the unlikely event that they cause a lint
    # error.
    lint:
      priority: 3
      run: DIRENV_LOG_FORMAT='' direnv exec "$PWD" bash scripts/lint/lint.bash {staged_files}

post-merge:
  commands:
    post-change:
      interactive: true
      run: DIRENV_LOG_FORMAT='' direnv exec "$PWD" bash ./.git-hook-assets/on-change.bash

post-rewrite:
  scripts:
    "post-rewrite.bash":
      interactive: true
      runner: DIRENV_LOG_FORMAT='' direnv exec "$PWD" bash

post-checkout:
  scripts:
    "post-checkout.bash":
      interactive: true
      runner: DIRENV_LOG_FORMAT='' direnv exec "$PWD" bash

pre-push:
  scripts:
    "pre-push.bash":
      interactive: true
      runner: DIRENV_LOG_FORMAT='' direnv exec "$PWD" bash
